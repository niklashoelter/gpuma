{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"GPUMA","text":"<p>GPUMA is a minimalist Python toolkit for facile and rapid high-throughput molecular geometry optimization  based on the UMA/OMol25 machine-learning interatomic potential.  </p> <p>GPUMA is especially designed for batch optimizations of many structures (conformer ensembles, datasets) on GPU, ensuring efficient parallelization and maximum GPU utilization by leveraging the torch-sim library. It wraps Fairchem UMA models and torch-sim functionality to provide both a simple command-line  interface (CLI) and a small but expressive Python API for single- and multi-structure optimizations.</p> <p>If conformer sampling is desired, GPUMA can generate conformer ensembles on the fly from SMILES strings  using the morfeus library. Alternative input formats are described in the CLI section below.</p> <p>Feedback and improvements are always welcome!</p>"},{"location":"#installation","title":"Installation","text":""},{"location":"#option-1-install-from-pypi-recommended","title":"Option 1: Install from PyPI (recommended)","text":"<pre><code>pip install gpuma\n</code></pre> <p>This installs <code>gpuma</code> together with its core dependencies. Make sure you are using Python 3.12 or newer.</p>"},{"location":"#option-2-install-from-source","title":"Option 2: Install from source","text":"<pre><code># clone the repository\ngit clone https://github.com/niklashoelter/gpuma.git\ncd gpuma\n\n# install using (uv) pip\nuv pip install .\n# or, without uv:\npip install .\n</code></pre>"},{"location":"#documentation","title":"Documentation","text":"<p>Full documentation is available at https://niklashoelter.github.io/gpuma/.</p> <p>Please refer to the documentation for detailed configuration options and advanced usage. Using a configuration file is highly recommended for reproducibility and ease of use.</p> <p>Also check the examples folder in the repository for sample config files and usage examples.</p>"},{"location":"#cli-usage","title":"CLI Usage","text":"<p>The CLI is provided via the command <code>gpuma</code>. For best results, create a config file (JSON or YAML) and reference it in all CLI calls. </p> <p>Refer to the documentation for details on configuration options and CLI usage.</p>"},{"location":"#python-api","title":"Python API","text":"<p>A minimalistic and high-level Python API is provided for easy integration into custom scripts and workflows.</p> <p>Please refer to the documentation for detailed usage examples and API reference.</p>"},{"location":"#known-limitations","title":"Known limitations","text":"<p>When a run is started from SMILES, an RDKit force field (via the morfeus library) is used to generate an initial structure. Spin is not taken into account during this step, so the initial estimated geometries can be incorrect. When the UMA/Omol25 models are applied subsequently, the structure can sometimes be optimized to a maximum rather than a minimum because the model is not provided with Hessian matrices. This behavior only affects runs originating from SMILES; it does not occur with better starting geometries (e.g., when starting from XYZ files).</p>"},{"location":"#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Missing libraries: install optional dependencies like <code>pyyaml</code> if you use YAML configs.</li> <li>Fairchem/UMA: ensure network access for model downloads and optionally set or provide  <code>huggingface_token</code> (e.g., via a token file) to access the UMA model family.</li> </ul>"},{"location":"#license","title":"License","text":"<p>MIT License (see LICENSE)</p>"},{"location":"LICENSE/","title":"License","text":"<p>MIT License</p> <p>Copyright (c) 2025 Niklas H\u00f6lter</p> <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> <p>THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>"},{"location":"cli/","title":"CLI Usage","text":"<p>The CLI is provided via the command <code>gpuma</code>. For best results, create a config file (JSON or YAML) and reference it in all CLI calls.</p> <p>Important: For the optimatzion of very large ensembles or high-throughput workflows, using the batch optimization mode is recommended (set in the config file, see below). In this case, make sure to use a multi-XYZ input file or a directory of XYZ files and only start one GPUMA process to leverage maximum efficient GPU parallelization and avoid runtime overhead for model initialization and memory estimation.</p> <p>Recommended CLI usage:</p> <pre><code># Optimize a single structure from SMILES using a config file\ngpuma optimize --smiles \"C=C\" --output examples/example_output/cli_smiles_ethylene_opt.xyz --config examples/config.json\n\n# Optimize a triplet state from SMILES (multiplicity = 3)\n# Charge is inferred from the SMILES; multiplicity is set via CLI\ngpuma optimize --smiles \"C=C\" --multiplicity 3 --output examples/example_output/cli_smiles_ethylene_triplet_opt.xyz --config examples/config.json\n\n# Optimize a single structure from an XYZ file\ngpuma optimize --xyz examples/example_input_xyzs/single_xyz_file.xyz --output examples/example_output/cli_single_xyz_optimization.xyz --config examples/config.json\n\n# Create and optimize a conformer ensemble from SMILES\ngpuma ensemble --smiles \"c1c(CCOCC)cccc1\" --conformers 10 --output examples/example_output/cli_ensemble_optimization.xyz --config examples/config.json\n\n# Batch optimization from a multi-XYZ file\ngpuma batch --multi-xyz examples/example_input_xyzs/multi_xyz_file.xyz \\\n  --output examples/example_output/cli_multi_xyz_file_optimization.xyz --config examples/config.json\n\n# Batch optimization from a directory of XYZ files\ngpuma batch --xyz-dir examples/example_input_xyzs/multi_xyz_dir/ --output examples/example_output/cli_multi_xyz_dir_optimization.xyz  --config examples/config.json\n\n# Batch optimization from a directory of XYZ files with modified charge/spin\ngpuma batch --xyz-dir examples/example_input_xyzs/multi_xyz_dir/ --output examples/example_output/cli_multi_xyz_dir_optimization_modified_charge_spin.xyz --charge 1 --multiplicity 2 --config examples/config.json\n\n# Convert SMILES to XYZ (no optimization)\ngpuma convert --smiles \"CCO\" --output examples/example_output/cli_no_optimization.xyz --config examples/config.json\n\n# Generate conformers from SMILES (no optimization)\ngpuma generate --smiles \"c1ccccc1\" --conformers 5 --output examples/example_output/cli_conformer_generation.xyz --config examples/config.json\n\n# Create or validate configuration files\ngpuma config --create examples/config.json\ngpuma config --validate examples/config.json\n\n# Verbose vs. quiet (set in config file)\ngpuma optimize --smiles \"CCO\" --output examples/example_output/ethanol_verbose.xyz --config examples/config.json\ngpuma ensemble --smiles \"CCO\" --conformers 3 --output examples/example_output/ethanol_ensemble_verbose.xyz --config examples/config.json\n</code></pre> <p>Note: - If <code>--config</code> is not specified, <code>config.json</code> in the current directory is loaded by default. - Direct CLI flags are supported, but using a config file is preferred for all workflows. - Unless explicitly overridden, the electronic state defaults are always   <code>charge = 0</code> and <code>multiplicity = 1</code>.</p> <ul> <li>For SMILES inputs, the total charge is automatically inferred from the   SMILES via RDKit/MORFEUS. The multiplicity can be controlled globally via   the config (<code>optimization.multiplicity</code>) or overridden per CLI call with   <code>--multiplicity</code> where supported. Internally this is passed to the models   as the <code>spin</code> channel.</li> <li>For XYZ inputs (single and batch), both charge and multiplicity can be   set via CLI flags (<code>--charge</code>, <code>--multiplicity</code>) or via the config   (<code>optimization.charge</code>, <code>optimization.multiplicity</code>). CLI flags override the   config values. These values are passed down to the models as   <code>Atoms.info = {\"charge\": charge, \"spin\": multiplicity}</code> and are written to   the XYZ comments as <code>Charge: ... | Multiplicity: ...</code>.</li> </ul> <p>You can control the compute device globally in the config or from the CLI with <code>--device</code> (which overrides the config). Accepted values are <code>cpu</code> for CPU-only execution and <code>cuda</code> to enable GPU acceleration.</p> <p>GPU selection: Fairchem currently does not support selecting a specific GPU via the <code>device</code> argument. To target particular GPUs you should set the <code>CUDA_VISIBLE_DEVICES</code> environment variable before calling <code>gpuma</code>, e.g.:</p> <pre><code># use only GPU 1\nCUDA_VISIBLE_DEVICES=1 gpuma optimize --smiles \"C=C\" --output examples/example_output/ethylene_opt_gpu1.xyz --config examples/config.json\n\n# use GPUs 1,2,3\nCUDA_VISIBLE_DEVICES=1,2,3 gpuma batch --xyz-dir examples/multi_xyz_dir/ --output examples/example_output/optimized_dir_gpu123.xyz --config examples/config.json\n</code></pre>"},{"location":"config/","title":"Configuration","text":"<p>All supported parameters live under the <code>optimization</code> key. Only these parameters are effective in the code; unknown fields are preserved.</p> <p>Always use a config file for CLI and API calls.</p> <p>Example (JSON):</p> <pre><code>{\n  \"optimization\": {\n    \"batch_optimization_mode\": \"batch\",\n    \"batch_optimizer\": \"fire\",\n    \"max_num_conformers\": 20,\n    \"conformer_seed\": 42,\n\n    \"charge\": 0,\n    \"multiplicity\": 1,\n\n    \"force_convergence_criterion\": 5e-2,\n    \"energy_convergence_criterion\": null,\n\n    \"model_name\": \"uma-m-1p1\",\n    \"model_path\": null,\n    \"model_cache_dir\": null,\n    \"device\": \"cuda\",\n    \"huggingface_token\": null,\n    \"huggingface_token_file\": \"/home/hf_secret\",\n\n    \"logging_level\": \"INFO\"\n  }\n}\n</code></pre> <p>Example (YAML):</p> <pre><code>optimization:\n  batch_optimization_mode: batch\n  batch_optimizer: fire\n  max_num_conformers: 20\n  conformer_seed: 42\n\n  charge: 0\n  multiplicity: 1\n\n  force_convergence_criterion: 5.0e-2\n  energy_convergence_criterion: null\n\n  model_name: uma-m-1p1\n  model_path: null\n  model_cache_dir: null\n  device: cuda\n  huggingface_token: null\n  huggingface_token_file: /home/hf_secret\n\n  logging_level: INFO\n</code></pre>"},{"location":"config/#supported-parameters","title":"Supported Parameters","text":"<ul> <li><code>batch_optimization_mode</code>: controls the ensemble mode</li> <li><code>sequential</code>: ASE/BFGS per conformer with a shared calculator</li> <li><code>batch</code>: torch-sim batch optimization (accelerated for larger ensembles)</li> <li><code>batch_optimizer</code>: optimizer for batch mode; <code>fire</code> (default) or <code>gradient_descent</code></li> <li><code>max_num_conformers</code>: max number of conformers to generate from SMILES (if applicable)</li> <li><code>conformer_seed</code>: random seed for conformer generation (if applicable)</li> <li><code>charge</code>: total charge of the system (for SMILES this is inferred from the   input and not overridden by this setting)</li> <li><code>multiplicity</code>: spin multiplicity of the system</li> <li><code>force_convergence_criterion</code>: force convergence threshold (default: 5e-2).   Used for both single and batch optimizations.</li> <li><code>energy_convergence_criterion</code>: energy convergence threshold (default: None).   If provided, it is used for batch optimization (unless force is also set).   Not supported for single structure optimization.</li> <li><code>model_name</code>: Fairchem UMA model name (e.g., <code>uma-m-1p1</code>)</li> <li><code>model_path</code>: local path to a Fairchem UMA model (overrides <code>model_name</code> if set)</li> <li><code>model_cache_dir</code>: directory to cache downloaded models (default: <code>~/.cache/fairchem</code>)</li> <li> <p><code>device</code>: compute device string; one of <code>cpu</code> or <code>cuda</code>.   Fairchem only distinguishes between CPU and CUDA; selection of specific   GPUs should be handled via the <code>CUDA_VISIBLE_DEVICES</code> environment variable   before running the CLI or Python code.</p> </li> <li> <p><code>huggingface_token</code>: optional HF token for model access (if required)</p> </li> <li><code>huggingface_token_file</code>: optional file path to read the HF token from</li> <li><code>logging_level</code>: logging verbosity; e.g., <code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code></li> </ul> <p>See the <code>examples/</code> folder for: - Simple single optimization (<code>example_single_optimization.py</code>) - Ensemble optimization from SMILES, multi-XYZ, directories (<code>example_ensemble_optimization.py</code>) - CLI examples (<code>example_cli_usage.py</code>)</p> <p>The example configs are sanitized (no tokens in plain text).</p>"},{"location":"install/","title":"Installation","text":""},{"location":"install/#option-1-install-from-pypi-recommended","title":"Option 1: Install from PyPI (recommended)","text":"<pre><code>pip install gpuma\n</code></pre> <p>This installs <code>gpuma</code> together with its core dependencies. Make sure you are using Python 3.12 or newer.</p> <p>\u26a0\ufe0f Required for UMA models: To access the UMA models on Hugging Face, you must provide a token either via the <code>HUGGINGFACE_TOKEN</code> environment variable or via the config (direct token string or path to a file containing the token).</p>"},{"location":"install/#option-2-install-from-source","title":"Option 2: Install from source","text":"<pre><code># clone the repository\ngit clone https://github.com/niklashoelter/gpuma.git\ncd gpuma\n\n# install using (uv) pip\nuv pip install .\n# or, without uv:\npip install .\n</code></pre>"},{"location":"reference/","title":"Python API","text":"<p>Documentation for the core optimization functions in <code>gpuma</code>.</p> <p>Public high-level Python API for common geometry optimization workflows.</p> <p>This module provides convenience functions built on top of the lower-level I/O and optimization utilities. It allows users to easily optimize molecular structures starting from SMILES strings or XYZ files, as well as optimizing ensembles of conformers.</p>"},{"location":"reference/#single-structure-optimization","title":"Single Structure Optimization","text":"<p>Methods for optimizing individual molecules provided as SMILES or XYZ files.</p>"},{"location":"reference/#gpuma.api.optimize_single_smiles","title":"<code>optimize_single_smiles(smiles, output_file=None, config=None)</code>","text":"<p>Optimize a single molecule from a SMILES string.</p> <p>This function uses the provided SMILES string to generate an initial 3D structure using the Morfeus library. It then optimizes the structure using the specified optimization pipeline.</p> <p>Parameters:</p> Name Type Description Default <code>smiles</code> <code>str</code> <p>SMILES string of the molecule to optimize.</p> required <code>output_file</code> <code>str</code> <p>Path to an output XYZ file where the optimized structure will be written. If None, the optimized structure is not saved to a file.</p> <code>None</code> <code>config</code> <code>Config</code> <p>Config object to control the optimization pipeline. Highly recommended to specify. If None, the configuration will be loaded from the default file.</p> <code>None</code> <p>Returns:</p> Name Type Description <code>Structure</code> <code>Structure</code> <p>The optimized molecular structure as a Structure object.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If the generated structure is not valid.</p> Source code in <code>src/gpuma/api.py</code> <pre><code>def optimize_single_smiles(\n    smiles: str,\n    output_file: str | None = None,\n    config: Config | None = None,\n) -&gt; Structure:\n    \"\"\"Optimize a single molecule from a SMILES string.\n\n    This function uses the provided SMILES string to generate an initial 3D structure\n    using the Morfeus library. It then optimizes the structure using the specified\n    optimization pipeline.\n\n    Args:\n        smiles (str): SMILES string of the molecule to optimize.\n        output_file (str): Path to an output XYZ file where the optimized structure\n            will be written. If None, the optimized structure is not saved to a file.\n        config (Config, optional): Config object to control the optimization pipeline.\n            Highly recommended to specify. If None, the configuration will be loaded\n            from the default file.\n\n    Returns:\n        Structure: The optimized molecular structure as a Structure object.\n\n    Raises:\n        ValueError: If the generated structure is not valid.\n\n    \"\"\"\n    if config is None:\n        config = load_config_from_file()\n\n    multiplicity = getattr(config.optimization, \"multiplicity\", 1)\n    structure = smiles_to_xyz(smiles, multiplicity=multiplicity)\n\n    if not isinstance(structure, Structure):\n        raise ValueError(\"smiles_to_xyz did not return a Structure\")\n    structure.comment = f\"Optimized from SMILES: {smiles}\"\n    result = optimize_single_structure(structure, config)\n\n    if output_file:\n        save_xyz_file(result, output_file)\n\n    return result\n</code></pre>"},{"location":"reference/#gpuma.api.optimize_single_xyz_file","title":"<code>optimize_single_xyz_file(input_file, output_file=None, config=None)</code>","text":"<p>Optimize a single structure from an XYZ file.</p> <p>This function reads a molecular structure from the specified XYZ file, optimizes it using the provided optimization pipeline, and optionally writes the optimized structure to an output XYZ file.</p> <p>Parameters:</p> Name Type Description Default <code>input_file</code> <code>str</code> <p>Path to an input XYZ file from which to read the initial structure.</p> required <code>output_file</code> <code>str</code> <p>Path to an output XYZ file where the optimized structure will be written. If None, the optimized structure will not be saved to a file.</p> <code>None</code> <code>config</code> <code>Config</code> <p>Config object to control the optimization pipeline. Highly recommended to specify. If None, the configuration will be loaded from the default file.</p> <code>None</code> <p>Returns:</p> Name Type Description <code>Structure</code> <code>Structure</code> <p>The optimized molecular structure as a Structure object.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If the input file does not exist or if the read structure is not valid.</p> Source code in <code>src/gpuma/api.py</code> <pre><code>def optimize_single_xyz_file(\n    input_file: str,\n    output_file: str | None = None,\n    config: Config | None = None,\n) -&gt; Structure:\n    \"\"\"Optimize a single structure from an XYZ file.\n\n    This function reads a molecular structure from the specified XYZ file,\n    optimizes it using the provided optimization pipeline, and optionally\n    writes the optimized structure to an output XYZ file.\n\n    Args:\n        input_file (str): Path to an input XYZ file from which to read the initial structure.\n        output_file (str): Path to an output XYZ file where the optimized structure will be written.\n            If None, the optimized structure will not be saved to a file.\n        config (Config, optional): Config object to control the optimization pipeline.\n            Highly recommended to specify. If None, the configuration will be loaded from\n            the default file.\n\n    Returns:\n        Structure: The optimized molecular structure as a Structure object.\n\n    Raises:\n        ValueError: If the input file does not exist or if the read structure is not valid.\n\n    \"\"\"\n    if not file_exists(input_file):\n        raise ValueError(f\"Input file {input_file} does not exist.\")\n    if config is None:\n        config = load_config_from_file()\n\n    eff_charge = int(getattr(config.optimization, \"charge\", 0))\n    eff_mult = int(getattr(config.optimization, \"multiplicity\", 1))\n    structure = read_xyz(input_file, charge=eff_charge, multiplicity=eff_mult)\n    if not isinstance(structure, Structure):\n        raise ValueError(\"read_xyz did not return a Structure\")\n    structure.comment = f\"Optimized from: {input_file}\"\n    result = optimize_single_structure(structure, config)\n\n    if output_file:\n        save_xyz_file(result, output_file)\n\n    return result\n</code></pre>"},{"location":"reference/#batch-ensemble-optimization","title":"Batch &amp; Ensemble Optimization","text":"<p>Methods for processing multiple structures, ensembles, or entire directories.</p>"},{"location":"reference/#gpuma.api.optimize_ensemble_smiles","title":"<code>optimize_ensemble_smiles(smiles, output_file=None, config=None)</code>","text":"<p>Optimize a conformer ensemble generated from a SMILES string.</p> <p>This function generates a specified number of conformers from the provided SMILES string using the Morfeus library. It then optimizes each conformer using the specified optimization pipeline. Optionally, the optimized ensemble can be saved to a multi-structure XYZ file.</p> <p>Parameters:</p> Name Type Description Default <code>smiles</code> <code>str</code> <p>SMILES string of the molecule for which to generate conformers.</p> required <code>output_file</code> <code>str</code> <p>Path to an output multi-structure XYZ file where the optimized ensemble will be written. If None, the ensemble is not saved to a file.</p> <code>None</code> <code>config</code> <code>Config</code> <p>Config object to control the optimization pipeline. Highly recommended to specify. If None, the configuration will be loaded from the default file.</p> <code>None</code> <p>Returns:</p> Type Description <code>list[Structure]</code> <p>list[Structure]: A list of optimized molecular structures as Structure objects.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If output_file is not specified when required or if the generated conformers are not valid.</p> Source code in <code>src/gpuma/api.py</code> <pre><code>def optimize_ensemble_smiles(\n    smiles: str,\n    output_file: str | None = None,\n    config: Config | None = None,\n) -&gt; list[Structure]:\n    \"\"\"Optimize a conformer ensemble generated from a SMILES string.\n\n    This function generates a specified number of conformers from the provided\n    SMILES string using the Morfeus library. It then optimizes each conformer\n    using the specified optimization pipeline. Optionally, the optimized ensemble\n    can be saved to a multi-structure XYZ file.\n\n    Args:\n        smiles (str): SMILES string of the molecule for which to generate conformers.\n        output_file (str, optional): Path to an output multi-structure XYZ file where\n            the optimized ensemble will be written. If None, the ensemble is not saved to a file.\n        config (Config, optional): Config object to control the optimization pipeline.\n            Highly recommended to specify. If None, the configuration will be loaded from\n            the default file.\n\n    Returns:\n        list[Structure]: A list of optimized molecular structures as Structure objects.\n\n    Raises:\n        ValueError: If output_file is not specified when required or if the generated\n            conformers are not valid.\n\n    \"\"\"\n    if config is None:\n        config = load_config_from_file()\n    multiplicity = int(getattr(config.optimization, \"multiplicity\", 1))\n    num_conformers = int(getattr(config.optimization, \"max_num_conformers\", 10))\n    conformers = smiles_to_ensemble(smiles, num_conformers, multiplicity)\n    if not isinstance(conformers, list) or (\n        len(conformers) and not isinstance(conformers[0], Structure)\n    ):\n        raise ValueError(\"smiles_to_ensemble did not return a list of Structure\")\n    for s in conformers:\n        s.multiplicity = multiplicity\n    results = optimize_structure_batch(conformers, config)\n\n    if output_file:\n        comments = [\n            f\"Optimized conformer {i + 1} from SMILES: {smiles}\" for i in range(len(results))\n        ]\n        save_multi_xyz(results, output_file, comments)\n\n    return results\n</code></pre>"},{"location":"reference/#gpuma.api.optimize_batch_multi_xyz_file","title":"<code>optimize_batch_multi_xyz_file(input_file, output_file=None, config=None)</code>","text":"<p>Optimize a batch of structures from a multi-structure XYZ file.</p> <p>This function reads multiple molecular structures from the specified multi-structure XYZ file, optimizes each structure using the provided optimization pipeline, and writes the optimized structures to an output multi-structure XYZ file.</p> <p>Parameters:</p> Name Type Description Default <code>input_file</code> <code>str</code> <p>Path to an input multi-structure XYZ file from which to read the initial structures.</p> required <code>output_file</code> <code>str</code> <p>Path to an output multi-structure XYZ file where the optimized structures will be written. If None, the optimized structures will not be saved to a file.</p> <code>None</code> <code>config</code> <code>Config</code> <p>Config object to control the optimization pipeline. Highly recommended to specify. If None, the configuration will be loaded from the default file.</p> <code>None</code> <p>Returns:</p> Type Description <code>list[Structure]</code> <p>list[Structure]: A list of optimized molecular structures as Structure objects.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If the input file does not exist or if the read structures are not valid.</p> Source code in <code>src/gpuma/api.py</code> <pre><code>def optimize_batch_multi_xyz_file(\n    input_file: str,\n    output_file: str | None = None,\n    config: Config | None = None,\n) -&gt; list[Structure]:\n    \"\"\"Optimize a batch of structures from a multi-structure XYZ file.\n\n    This function reads multiple molecular structures from the specified multi-structure\n    XYZ file, optimizes each structure using the provided optimization pipeline, and writes\n    the optimized structures to an output multi-structure XYZ file.\n\n    Args:\n        input_file (str): Path to an input multi-structure XYZ file from which to\n            read the initial structures.\n        output_file (str): Path to an output multi-structure XYZ file where the optimized\n            structures will be written.\n            If None, the optimized structures will not be saved to a file.\n        config (Config, optional): Config object to control the optimization pipeline.\n            Highly recommended to specify. If None, the configuration will be loaded from\n            the default file.\n\n    Returns:\n        list[Structure]: A list of optimized molecular structures as Structure objects.\n\n    Raises:\n        ValueError: If the input file does not exist or if the read structures are not valid.\n\n    \"\"\"\n    if not file_exists(input_file):\n        raise ValueError(f\"Input file {input_file} does not exist.\")\n\n    if config is None:\n        config = load_config_from_file()\n\n    eff_charge = int(getattr(config.optimization, \"charge\", 0))\n    eff_mult = int(getattr(config.optimization, \"multiplicity\", 1))\n\n    structures = cast(\n        list[Structure],\n        read_multi_xyz(input_file, charge=eff_charge, multiplicity=eff_mult),\n    )\n    if not isinstance(structures, list) or (\n        len(structures) and not isinstance(structures[0], Structure)\n    ):\n        raise ValueError(\"read_multi_xyz did not return a list of Structure\")\n\n    results = optimize_structure_batch(structures, config)\n\n    if output_file:\n        comments = [\n            f\"Optimized structure {i + 1} from: {input_file}\" for i in range(len(results))\n        ]\n        save_multi_xyz(results, output_file, comments)\n\n    return results\n</code></pre>"},{"location":"reference/#gpuma.api.optimize_batch_xyz_directory","title":"<code>optimize_batch_xyz_directory(input_directory, output_file, config=None)</code>","text":"<p>Optimize a batch of structures from XYZ files in a directory.</p> <p>This function reads multiple molecular structures from XYZ files in the specified input directory, optimizes each structure using the provided optimization pipeline, and writes the optimized structures to XYZ files in the specified output directory.</p> <p>Parameters:</p> Name Type Description Default <code>input_directory</code> <code>str</code> <p>Path to an input directory containing XYZ files.</p> required <code>output_file</code> <code>str</code> <p>Path to an output multi-structure XYZ file where the optimized structures will be written.</p> required <code>config</code> <code>Config</code> <p>Config object to control the optimization pipeline. Highly recommended to specify. If None, the configuration will be loaded from the default file.</p> <code>None</code> <p>Returns:</p> Type Description <code>list[Structure]</code> <p>list[Structure]: A list of optimized molecular structures as Structure objects.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If the input directory does not exist or contains no valid XYZ files.</p> Source code in <code>src/gpuma/api.py</code> <pre><code>def optimize_batch_xyz_directory(\n    input_directory: str,\n    output_file: str,\n    config: Config | None = None,\n) -&gt; list[Structure]:\n    \"\"\"Optimize a batch of structures from XYZ files in a directory.\n\n    This function reads multiple molecular structures from XYZ files in the specified input\n    directory, optimizes each structure using the provided optimization pipeline,\n    and writes the optimized structures to XYZ files in the specified output directory.\n\n    Args:\n        input_directory (str): Path to an input directory containing XYZ files.\n        output_file (str): Path to an output multi-structure XYZ file where the\n            optimized structures will be written.\n        config (Config, optional): Config object to control the optimization pipeline.\n            Highly recommended to specify. If None, the configuration will be loaded from the\n            default file.\n\n    Returns:\n        list[Structure]: A list of optimized molecular structures as Structure objects.\n\n    Raises:\n        ValueError: If the input directory does not exist or contains no valid XYZ files.\n\n    \"\"\"\n    if config is None:\n        config = load_config_from_file()\n\n    eff_charge = int(getattr(config.optimization, \"charge\", 0))\n    eff_mult = int(getattr(config.optimization, \"multiplicity\", 1))\n\n    structures = cast(\n        list[Structure],\n        read_xyz_directory(\n            input_directory,\n            charge=eff_charge,\n            multiplicity=eff_mult,\n        ),\n    )\n\n    results = optimize_structure_batch(structures, config)\n\n    if output_file:\n        comments = [\n            f\"Optimized structure {i + 1} from batch input\"\n            for i in range(len(results))\n        ]\n        save_multi_xyz(results, output_file, comments)\n\n    return results\n</code></pre>"}]}